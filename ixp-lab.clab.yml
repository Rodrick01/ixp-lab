name: ixp-lab
prefix: ""

mgmt:
  network: clab
  ipv4-subnet: 10.254.0.0/24

topology:
  nodes:
    r1:
      kind: vr-vmx
      image: vrnetlab/vr-vmx:latest
      mgmt-ipv4: 10.254.0.11
    r3:
      kind: vr-vmx
      image: vrnetlab/vr-vmx:latest
      mgmt-ipv4: 10.254.0.13
    r4:
      kind: vr-vmx
      image: vrnetlab/vr-vmx:latest
      mgmt-ipv4: 10.254.0.14
    g2:
      kind: linux
      image: osrg/gobgp:latest
      mgmt-ipv4: 10.254.0.102
      binds:
        - ./g2_gobgpd.toml:/etc/gobgp/gobgpd.toml:ro
      exec:
        - ip addr add 10.1.12.2/24 dev eth1
        - ip addr add 10.173.176.2/24 dev eth2
        - gobgpd -f /etc/gobgp/gobgpd.toml -d
    rs:
      kind: linux
      image: osrg/gobgp:latest
      mgmt-ipv4: 10.254.0.150
      binds:
        - ./rs_gobgpd.toml:/etc/gobgp/gobgpd.toml:ro
      exec:
        - ip addr add 10.173.176.254/24 dev eth1
        - gobgpd -f /etc/gobgp/gobgpd.toml -d
    util:
      kind: linux
      image: alpine:3.18
      mgmt-ipv4: 10.254.0.250
    prometheus:
      kind: linux
      image: prom/prometheus:latest
      mgmt-ipv4: 10.254.0.201
      ports:
        - 9090:9090
      binds:
        - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
    grafana:
      kind: linux
      image: grafana/grafana:latest
      mgmt-ipv4: 10.254.0.202
      ports:
        - 3000:3000
    ix-switch:
      kind: bridge

  links:
    - endpoints: ["r1:eth1", "r4:eth1"]
    - endpoints: ["r1:eth2", "g2:eth1"]
    - endpoints: ["g2:eth2", "ix-switch:eth1"]
    - endpoints: ["rs:eth1", "ix-switch:eth2"]
    - endpoints: ["r3:eth1", "ix-switch:eth3"]
    - endpoints: ["r1:eth3", "ix-switch:eth4"]
